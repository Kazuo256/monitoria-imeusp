<h1>Monitores eleitos</h1>

<% @assistant_roles_by_semester.each do |entry| %>
  <h2>
    <%= entry[:semester].as_s %>
  </h2>
  <% if secretary_signed_in? %>
    <% unless Rails.env.production? %>
      <%= link_to "Pedir avaliações dos professores", request_assistant_evaluations_for_semester_path(entry[:semester]), method: :post %>
    <% end %>
    <%= link_to "Notificar monitores", notify_assistant_roles_for_semester_path(entry[:semester]), method: :post %>   
    <%= link_to "Pedir frequências", request_frequency_path, method: :post %> 
  <% end %>
  <table>
    <thead>
      <tr>
        <th><%= t('activerecord.attributes.student.name') %> </th>
        <th><%= t('activerecord.attributes.request_for_teaching_assistant.course_id') %> </th>
        <th><%= t('activerecord.attributes.request_for_teaching_assistant.professor_id') %> </th>
        <% if secretary_signed_in? or (user_signed_in? and current_user.super_professor?) %>
          <th></th>
        <% end %>
      </tr>
    </thead>

    <tbody>
      <% entry[:role].each do |role| %>
        <tr>
          <td><%= role.student.name %></td>
          <td><%= role.request_for_teaching_assistant.course.course_code %></td>
          <td><%= role.request_for_teaching_assistant.professor.name %></td>
          <% if secretary_signed_in? or (user_signed_in? and current_user.super_professor?) %>
            <td>
              <%if role.active %>
                <%= link_to "Desativar", deactivate_assistant_role_path(role.id), method: :post, data: { confirm: 'Deseja mesmo desativar este monitor?' } %></td>
              <% else %>
                Desativado
              <% end %>
          <% end %>
        </tr>
        <tr>
          <td colspan=4>
            <% @months.each do |month| %>
            <% status = role.frequency_status_for_month(month) %>
            <% color = "black" %>
            <%= "&nbsp;&bull;".html_safe %>
            <%= " #{months_to_names[month]}: " %>  
            <% if status == "Pendente" && !secretary_signed_in? %>
              <%= content_tag :span, style: "padding-right: 30px" do -%>
              <%= link_to "Marcar presença", 
              mark_assistant_role_frequency_path(role: role.id, month: month, presence: true, pid: -1), method: :post, data: { confirm: 'Deseja mesmo marcar presença para este monitor?' }  %>
              <% end -%>
              <%= content_tag :span, style: "" do -%>
              <%= link_to "Marcar ausência",
              mark_assistant_role_frequency_path(role: role.id, month: month, presence: false, pid: -1), method: :post, data: { confirm: 'Deseja mesmo marcar ausência para este monitor?' }  %>
              <% end -%>
            <% else %>
              <% if status == "Presente"
                    color = "green"
                 elsif status == "Ausente"
                    color = "red"
                 else
                    color = "darkgoldenrod"
                 end
              %>
              <%= content_tag :span, style: "color:#{color}" do -%>
              <%= status %>
              <% end -%>
            <% end %>    
            <br>
            <% end %>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>
<% end %>

